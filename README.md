# ðŸŽŠ í•­í•´99 ë¯¸ë‹ˆí”„ë¡œì íŠ¸

## í•­í•´ë§ˆì¼“ | ì¤‘ê³ ì œí’ˆ ì§ê±°ëž˜ í”Œëž«í¼ ì‚¬ì´íŠ¸

### ê°œìš”
- ëª…ì¹­ : í•­í•´ë§ˆì¼“
- ê°œë°œ ì¸ì› : 5ëª… (í”„ë¡ íŠ¸ 2ëª…[í—ˆë¯¼ê·œ,ì´ì§€ì€], ë°±ì—”ë“œ 3ëª…[ê¹€ìŠ¹ìš±,ìž¥í˜„ì¤€,ì´ì€ì§€])
- ê°œë°œ ê¸°ê°„ : 2021.04.09 ~ 2021.04.22
- ê°œë°œ í™˜ê²½ : React, Spring
- í˜•ìƒ ê´€ë¦¬ íˆ´ : git
- ì¼ì • ê´€ë¦¬ íˆ´ : [Notion](https://www.notion.so/3295a6aca9bd411b9cc7b5eadb9239cb?v=002a8755c0414bf388614efa88f27d8a)
- ì‚¬ì´íŠ¸ : [í•­í•´ë§ˆì¼“(í˜„ìž¬ëŠ” ì„œë²„ê°€ ë‚´ë ¤ê°„ ìƒíƒœ)](http://hanghaemarket.shop/)
- ì‹œì—° ì˜ìƒ : [ìœ íŠœë¸Œ ë§í¬](https://youtube.com/watch?v=idAJS0OLPhY&feature=share)  

### ë©¤ë²„êµ¬ì„±
+ Frontend - React
  + í—ˆë¯¼ê·œ
    + íšŒì›ê°€ìž…/ë¡œê·¸ì¸ êµ¬í˜„
    + í—¤ë” ì œìž‘
    + ì±„íŒ… ëª¨ë‹¬ ì œìž‘
    + ë¦¬ë•ìŠ¤ ëª¨ë“ˆ ì½”ë“œ ìž‘ì„±
    + í´ë¼ì´ì–¸íŠ¸-ì„œë²„ê°„ì˜ ìš”ì²­-ì‘ë‹µ ê³¼ì • í…ŒìŠ¤íŠ¸ ë° êµ¬í˜„
  + ì´ì§€ì€
    + ë©”ì¸íŽ˜ì´ì§€/ìƒì„¸íŽ˜ì´ì§€ ë·° ì œìž‘
    + ìƒí’ˆê²Œì‹œë¬¼ ìž‘ì„±/ìˆ˜ì • íŽ˜ì´ì§€ ë·° ì œìž‘
    + ìƒí’ˆê²Œì‹œë¬¼ ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬ì°½ ì œìž‘
+ Backend - Spring ([ë²¡ì—”ë“œ ê¹ƒí—ˆë¸Œ ë ˆí¬](https://github.com/rlatmd0829/hanghae99_market)) 
  + ìž¥í˜„ì¤€
  + ê¹€ìŠ¹ìš±
  + ì´ì€ì§€
  
### í”„ë¡œì íŠ¸ íŠ¹ì§•
- React, Springì„ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡œì íŠ¸ êµ¬í˜„

    - ê° íŒŒíŠ¸ì˜ ë³„ë„ Repositoryë¥¼ ìƒì„± í›„ ìž‘ì—…
    - í”„ë¡ íŠ¸ : AWS S3 ì •ì  í˜¸ìŠ¤íŒ…
    - ë°±ì—”ë“œ : AWS EC2 ì„œë²„ í˜¸ìŠ¤íŒ…
    - ë¹Œë“œ í›„, S3ì™€ EC2 ì—°ë™

- ë¡œê·¸ì¸ ì²˜ë¦¬ëŠ” Jwt Token ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬
- ê²Œì‹œê¸€ ìž‘ì„± ì‹œ í”„ë¡ íŠ¸ì—ì„œ ì´ë¯¸ì§€ íŒŒì¼ í˜•íƒœë¡œ ë°›ì•„ ì„œë²„ì¸¡ì—ì„œ S3ì— ì—…ë¡œë“œ í›„ Url ëŒë ¤ì£¼ëŠ” ë°©ì‹
- ì±„íŒ…ì€ STOMPì™€ SockJSë¡œ êµ¬ì„±
  
### í”„ë¡œì íŠ¸ ê¸°ëŠ¥

- ë¡œê·¸ì¸, íšŒì›ê°€ìž…
- ì†Œì…œë¡œê·¸ì¸
- ê²Œì‹œê¸€ CRUD
- ì´ë¯¸ì§€ S3 ì—…ë¡œë“œ
- ëŒ“ê¸€ CRUD
- ì°œí•˜ê¸° (ì¢‹ì•„ìš”)
- íŒ”ë¡œìš°
- ì±„íŒ…

### API ì„¤ê³„
![image](https://user-images.githubusercontent.com/70622731/115699219-6b95b400-a3a0-11eb-8c00-c4fcd0c3f420.png)
![image](https://user-images.githubusercontent.com/70622731/115699310-823c0b00-a3a0-11eb-94ca-103b24c80005.png)
![image](https://user-images.githubusercontent.com/70622731/115699379-9122bd80-a3a0-11eb-97e6-f309d5b65f61.png)
![image](https://user-images.githubusercontent.com/70622731/115699448-a0097000-a3a0-11eb-9efc-1780f32e21b8.png)

## ì„œë¹„ìŠ¤ êµ¬í˜„ ì‚¬ì§„

### 1. íšŒì›ê°€ìž…
- ë©”ì¸íŽ˜ì´ì§€
  - ì „ì²´ì ì¸ êµ¬ì„± : ìœ„ì—ì„œë¶€í„° í—¤ë”/ê°€ìš´ë°ê¸€/ìƒí’ˆ ê²Œì‹œë¬¼ ëª©ë¡ 
![í•­í•´1](https://user-images.githubusercontent.com/79818840/119585961-c76fb480-be06-11eb-9135-3f4b510d3d21.JPG)

- íšŒì›ê°€ìž…íŽ˜ì´ì§€
![í•­í•´2](https://user-images.githubusercontent.com/79818840/119585965-cb033b80-be06-11eb-84fc-5db72df29391.JPG)

- ë¡œê·¸ì¸ íŽ˜ì´ì§€
  - ì¼ë°˜ë¡œê·¸ì¸ì„ êµ¬í˜„
![í•­í•´3](https://user-images.githubusercontent.com/79818840/119585968-ccccff00-be06-11eb-88d8-8cffc50b94fc.JPG)

- ê²Œì‹œë¬¼ ìž‘ì„±ì°½
  - ê²Œì‹œë¬¼ ì‚¬ì§„, ì œëª©, ê°€ê²©, ì„¤ëª…ì„ ì˜¬ë¦°ë‹¤.
  - APIë¥¼ ì´ìš©í•´ ì„œë²„ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ê³ , ë¦¬ë•ìŠ¤ì— ë°ì´í„°ë¥¼ ì €ìž¥ì‹œì¼œ ìƒˆë¡œê³ ì¹¨ ì—†ì´ë„ ë©”ì¸íŽ˜ì´ì§€ì— ê²Œì‹œë¬¼ë¡œ ëœ¨ê²Œ í•œë‹¤.
![í•­í•´4](https://user-images.githubusercontent.com/79818840/119585970-cdfe2c00-be06-11eb-8094-144f4c13704e.JPG)
![í•­í•´5](https://user-images.githubusercontent.com/79818840/119585972-cf2f5900-be06-11eb-8529-7c312a09c47c.JPG)
![í•­í•´6](https://user-images.githubusercontent.com/79818840/119585975-d0608600-be06-11eb-8d68-af7ca40929a2.JPG)

- ê²Œì‹œë¬¼ ìƒì„¸íŽ˜ì´ì§€
  - ë©”ì¸íŽ˜ì´ì§€ì—ëŠ” ë³´ì´ì§€ ì•ŠëŠ” ë” ìƒì„¸í•œ ì •ë³´(ë°°ì†¡ë¹„, ê±°ëž˜ì§€ì—­ ë“±ë“±)ë¥¼ ë³´ì—¬ì¤€ë‹¤.
  - ì°œ, ì±„íŒ…ê¸°ëŠ¥ì´ ìžˆë‹¤
![í•­í•´7](https://user-images.githubusercontent.com/79818840/119585977-d191b300-be06-11eb-9235-d60254e32f50.JPG)

- ì±„íŒ…ì°½
  - ê²Œì‹œë¬¼ ìƒì„¸íŽ˜ì´ì§€ì˜ ì±„íŒ…í•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì±„íŒ…ì°½ì´ ì—´ë¦°ë‹¤.
  - STOMP, SockJSì„ ì´ìš©í•´ ì„œë²„ì™€ í†µì‹ ì€ ì„±ê³µ
  - ì‹œê°„ ë¶€ì¡±ìœ¼ë¡œ ì¸í•´ì„œ ì±„íŒ… êµ¬í˜„ì€ ì™„ì„±í•˜ì§€ ëª»í•¨
![í•­í•´8](https://user-images.githubusercontent.com/79818840/119585979-d2c2e000-be06-11eb-9aeb-324c5e9fd97f.JPG)

- ë¡œê·¸ì•„ì›ƒì‹œ, localStorageì˜ ëª¨ë“  ë°ì´í„°ë“¤ì´ ì§€ì›Œì§€ê²Œ ì„¤ì •í–ˆë‹¤.
![í•­í•´9](https://user-images.githubusercontent.com/79818840/119585984-d35b7680-be06-11eb-94f8-8bc836a11f4b.JPG)
![í•­í•´10](https://user-images.githubusercontent.com/79818840/119585987-d48ca380-be06-11eb-9977-d88f446ba534.JPG)

### ì•„ì‰¬ìš´ ì  - ì±„íŒ…ìš© ì½”ë“œ(ì„œë²„ì™€ í†µì‹ ì€ ì„±ê³µ, ì‹œê°„ë¶€ì¡±ìœ¼ë¡œ êµ¬í˜„ ì™„ì„±ì€ ì‹¤íŒ¨

## SockJs, STOMP íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•œ ì„œë²„ì™€ì˜ ì±„íŒ…ìš© í†µì‹ ì„ ìœ„í•œ ì½”ë“œ
```ChatModal.js
// ì†Œì¼“ í†µì‹ 
import Stomp from 'stompjs';
import SockJS from 'sockjs-client';
import StompJS from '@stomp/stompjs';

const ChatModal = (props) => {

  const dispatch = useDispatch();

  let socket = new SockJS("http://52.78.12.253/chatting");
  // const ws = Stomp.over(sock);
  const stompClient = Stomp.over(socket);  // endpoint

  const post_list = useSelector((state) => {
      // console.log(state)
      // window.alert('')
      return state.post.detail_list
    });
  const target_idx = post_list.findIndex((p) => p.id == props.detail_id);
  const post_target = post_list[target_idx]
  
  // ì´ë©”ì¼ ì •ë³´
  const receiverEmail = post_target.email;
  const userEmail = localStorage.getItem('email');
  console.log(receiverEmail);

  const _token = localStorage.getItem("Authorization");
    let token = {
      headers : { Authorization: `${_token}` }, 
    }

  const API = `http://52.78.12.253/api/chat/newChat?receiver=${receiverEmail}&sender=${userEmail}`;
  axios.post(API, token)
    .then((response) => {
      console.log(response.data);

      let chatInfo = {
        senderName: response.data.senderName,
        senderEmail: response.data.senderEmail,
        senderId: response.data.senderId,
        receiverName: response.data.receiverName,
      }

      console.log(response.data.messages);
      console.log(chatInfo);
      dispatch(chatActions.getChatRoomInfo(chatInfo));
      // }
    }).catch((error) => {
      console.log(error)
      window.alert("ì±„íŒ… ë°ì´í„°ë“¤ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.")
    })

  React.useEffect(()=>{
    const userEmail = localStorage.getItem('email');
    console.log(stompClient);
    stompClient.connect({}, function () {
        stompClient.subscribe('/topic/' + userEmail, function (e) {
            if(e.body.toString() == "notice"){
                // alertClosing('noticeCome',2000);
            }
            else{
                // alertClosing('comeMessage',2000);
            }
          });
        });
    }, []);
    
```





